<!DOCTYPE html>
<html>
<head>
  <title>Bullpen Tracker Elite</title>
  <style>
    body {
      font-family: Arial;
      margin: 0;
      background: #f5f7fb;
      text-align: center;
    }

    h1 {
      margin-top: 20px;
    }

    select, input, button {
      padding: 8px;
      margin: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #menuBtn {
      font-size: 26px;
      position: absolute;
      left: 15px;
      top: 10px;
      cursor: pointer;
    }

    #sidebar {
      position: fixed;
      left: -220px;
      top: 0;
      width: 200px;
      height: 100%;
      background: #1e1e1e;
      color: white;
      padding: 15px;
      transition: 0.3s;
    }

    canvas {
      margin-top: 20px;
      border-radius: 10px;
      background: white;
      box-shadow: 0px 2px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>

<div id="menuBtn" onclick="toggleMenu()">☰</div>

<div id="sidebar">
  <h3>Pitchers</h3>
  <select id="pitcherSelect"></select>
  <input id="newPitcher" placeholder="Add pitcher">
  <button onclick="addPitcher()">Add</button>
</div>

<h1>⚾ Bullpen Tracker Elite</h1>

<select id="pitchType">
  <option>4-Seam</option>
  <option>2-Seam</option>
  <option>Slider</option>
  <option>Curveball</option>
  <option>Changeup</option>
</select>

<input id="velo" type="number" placeholder="Velo">

<br>

<canvas id="zone" width="320" height="320"></canvas>

<br>

<button onclick="drawHeatmap()">Heatmap</button>
<button onclick="showStats()">Stats</button>
<button onclick="exportCSV()">Export</button>

<script>
let pitches = JSON.parse(localStorage.getItem("bullpen")) || [];
let pitchers = JSON.parse(localStorage.getItem("pitchers")) || [];

const canvas = document.getElementById("zone");
const ctx = canvas.getContext("2d");
const pitcherSelect = document.getElementById("pitcherSelect");

/* MENU */
function toggleMenu() {
  const bar = document.getElementById("sidebar");
  bar.style.left = bar.style.left === "0px" ? "-220px" : "0px";
}

/* PITCHERS */
function loadPitchers() {
  pitcherSelect.innerHTML = "";
  pitchers.forEach(p => {
    let opt = document.createElement("option");
    opt.text = p;
    pitcherSelect.add(opt);
  });
}
loadPitchers();

function addPitcher() {
  let name = document.getElementById("newPitcher").value;
  if (!name) return;
  pitchers.push(name);
  localStorage.setItem("pitchers", JSON.stringify(pitchers));
  loadPitchers();
}

/* DRAW STRIKE ZONE */
function drawZone() {
  ctx.clearRect(0,0,320,320);

  // outer area
  ctx.strokeStyle = "#ccc";
  ctx.strokeRect(40,40,240,240);

  // strike zone
  ctx.strokeStyle = "black";
  ctx.lineWidth = 2;
  ctx.strokeRect(100,80,120,160);
}
drawZone();

/* CLICK TRACKING */
canvas.addEventListener("click", function(e) {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  savePitch(x,y);

  // draw dot immediately
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(x,y,4,0,Math.PI*2);
  ctx.fill();
});

function savePitch(x,y) {
  pitches.push({
    pitcher: pitcherSelect.value,
    type: document.getElementById("pitchType").value,
    velo: document.getElementById("velo").value,
    x: x,
    y: y
  });

  localStorage.setItem("bullpen", JSON.stringify(pitches));
}

/* HEATMAP PER PITCHER */
function drawHeatmap() {
  drawZone();

  let selected = pitcherSelect.value;

  pitches.forEach(p => {
    if (p.pitcher !== selected) return;

    ctx.fillStyle = "rgba(255,0,0,0.2)";
    ctx.beginPath();
    ctx.arc(p.x, p.y, 12, 0, Math.PI*2);
    ctx.fill();
  });
}

/* STATS */
function showStats() {
  let selected = pitcherSelect.value;
  let data = pitches.filter(p => p.pitcher === selected);

  let total = data.length;

  let strikes = data.filter(p =>
    p.x > 100 && p.x < 220 && p.y > 80 && p.y < 240
  ).length;

  let percent = total ? ((strikes/total)*100).toFixed(1) : 0;

  alert(`Pitcher: ${selected}\nTotal: ${total}\nStrike %: ${percent}%`);
}

/* EXPORT */
function exportCSV() {
  let csv = "Pitcher,Type,Velo,X,Y\n";

  pitches.forEach(p => {
    csv += `${p.pitcher},${p.type},${p.velo},${p.x},${p.y}\n`;
  });

  let blob = new Blob([csv], { type: 'text/csv' });
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "bullpen.csv";
  a.click();
}
</script>

</body>
</html>
